<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Shopping Cart - BookMarket</title>
        <meta
            name="description"
            content="Review your selected books and proceed to checkout on BookMarket."
        />

        <!-- Google Fonts -->
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Lora:wght@400;500;600&display=swap"
            rel="stylesheet"
        />

        <!-- Font Awesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        />

        <!-- Custom CSS -->
        <link rel="stylesheet" href="../css/styles.css" />

        <style>
            .cart-header {
                background: linear-gradient(
                    135deg,
                    var(--primary-navy) 0%,
                    #2c3e50 100%
                );
                color: white;
                padding: 3rem 0;
                text-align: center;
                position: relative;
                overflow: hidden;
            }

            .cart-header::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><defs><radialGradient id="a" cx="50%" cy="0%" r="100%"><stop offset="0%" stop-color="%23ffffff" stop-opacity="0.1"/><stop offset="100%" stop-color="%23ffffff" stop-opacity="0"/></radialGradient></defs><rect width="100" height="20" fill="url(%23a)"/></svg>');
                opacity: 0.1;
            }

            .cart-container {
                display: grid;
                grid-template-columns: 2fr 1fr;
                gap: 2rem;
                margin: 2rem 0;
            }

            .cart-items {
                background: white;
                border-radius: var(--border-radius);
                padding: 2rem;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }

            .cart-summary {
                background: white;
                border-radius: var(--border-radius);
                padding: 2rem;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
                height: fit-content;
                position: sticky;
                top: 120px;
            }

            .cart-item {
                border-bottom: 1px solid var(--border-gray);
                padding: 1.5rem 0;
                display: grid;
                grid-template-columns: auto 1fr auto;
                gap: 1rem;
                align-items: center;
            }

            .cart-item:last-child {
                border-bottom: none;
            }

            .book-image {
                width: 80px;
                height: 100px;
                object-fit: cover;
                border-radius: var(--border-radius);
            }

            .book-details {
                flex: 1;
            }

            .book-title {
                font-size: 1.1rem;
                font-weight: 600;
                color: var(--primary-navy);
                margin-bottom: 0.5rem;
            }

            .book-author {
                color: var(--text-light);
                margin-bottom: 0.5rem;
            }

            .stock-status {
                font-size: 0.9rem;
                color: var(--success);
                display: flex;
                align-items: center;
                gap: 0.25rem;
            }

            .quantity-controls {
                display: flex;
                align-items: center;
                gap: 0.75rem;
                margin-bottom: 1rem;
            }

            .quantity-btn {
                width: 35px;
                height: 35px;
                border: 1px solid var(--border-gray);
                background: white;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: var(--transition);
                font-size: 0.9rem;
            }

            .quantity-btn:hover {
                background: var(--primary-navy);
                color: white;
                border-color: var(--primary-navy);
            }

            .quantity-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            .quantity-btn:disabled:hover {
                background: white;
                color: var(--text-light);
                border-color: var(--border-gray);
            }

            .quantity-display {
                font-weight: 600;
                font-size: 1.1rem;
                min-width: 30px;
                text-align: center;
                color: var(--primary-navy);
            }

            .item-price {
                text-align: right;
            }

            .price-per-item {
                color: var(--text-light);
                font-size: 0.9rem;
                margin-bottom: 0.25rem;
            }

            .total-price {
                font-size: 1.3rem;
                font-weight: bold;
                color: var(--secondary-gold);
            }

            .remove-btn {
                background: none;
                border: none;
                color: var(--error);
                cursor: pointer;
                padding: 0.5rem;
                border-radius: 50%;
                transition: var(--transition);
                font-size: 1.1rem;
            }

            .remove-btn:hover {
                background: var(--error);
                color: white;
            }

            .summary-row {
                display: flex;
                justify-content: space-between;
                margin-bottom: 0.75rem;
                padding: 0.5rem 0;
            }

            .summary-row.total {
                border-top: 2px solid var(--border-gray);
                font-weight: bold;
                font-size: 1.2rem;
                color: var(--primary-navy);
                margin-top: 1rem;
                padding-top: 1rem;
            }

            .payment-methods {
                display: flex;
                gap: 0.5rem;
                justify-content: center;
                margin: 1rem 0;
                padding: 1rem;
                background: var(--light-gray);
                border-radius: var(--border-radius);
            }

            .payment-icon {
                padding: 0.5rem;
                border: 1px solid var(--border-gray);
                border-radius: 4px;
                background: white;
                font-size: 1.2rem;
            }

            .empty-cart {
                text-align: center;
                padding: 4rem 2rem;
                color: var(--text-light);
            }

            .empty-cart i {
                font-size: 4rem;
                margin-bottom: 1rem;
                opacity: 0.3;
            }

            .continue-shopping {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                color: var(--primary-navy);
                text-decoration: none;
                margin-bottom: 2rem;
                font-weight: 500;
                transition: var(--transition);
            }

            .continue-shopping:hover {
                color: var(--secondary-gold);
            }

            @media (max-width: 768px) {
                .cart-container {
                    grid-template-columns: 1fr;
                    gap: 1rem;
                }

                .cart-item {
                    grid-template-columns: 1fr;
                    text-align: center;
                    gap: 1rem;
                }

                .book-image {
                    width: 60px;
                    height: 75px;
                    justify-self: center;
                }

                .quantity-controls {
                    justify-content: center;
                }

                .cart-summary {
                    position: relative;
                    top: auto;
                }
            }
        </style>
    </head>
    <body>
        <!-- Navigation -->
        <div id="navbar-container"></div>

        <!-- Cart Header -->
        <section class="cart-header">
            <div class="container">
                <h1><i class="fas fa-shopping-cart"></i> Shopping Cart</h1>
                <p>Review your selected books and proceed to checkout</p>
            </div>
        </section>

        <!-- Main Content -->
        <main class="container">
            <!-- Continue Shopping Link -->
            <a href="../common/browse.html" class="continue-shopping">
                <i class="fas fa-arrow-left"></i>
                Continue Shopping
            </a>

            <!-- Cart Content -->
            <div class="cart-container" id="cart-container">
                <!-- Cart Items -->
                <div class="cart-items">
                    <div class="d-flex justify-between align-center mb-3">
                        <h2 style="margin: 0; color: var(--primary-navy)">
                            Cart Items (<span id="item-count">0</span>)
                        </h2>
                        <button
                            class="btn btn-outline btn-sm"
                            onclick="clearCart()"
                        >
                            <i class="fas fa-trash"></i>
                            Clear Cart
                        </button>
                    </div>

                    <div id="cart-items-list">
                        <!-- Cart items will be loaded here -->
                    </div>
                </div>

                <!-- Cart Summary -->
                <div class="cart-summary" id="cart-summary">
                    <!-- Summary will be loaded here -->
                </div>
            </div>

            <!-- Empty Cart State -->
            <div class="empty-cart" id="empty-cart" style="display: none">
                <i class="fas fa-shopping-cart"></i>
                <h3>Your cart is empty</h3>
                <p>Start shopping to add items to your cart</p>
                <a
                    href="../common/browse.html"
                    class="btn btn-primary"
                    style="margin-top: 1rem"
                >
                    <i class="fas fa-search"></i>
                    Browse Books
                </a>
            </div>
        </main>

        <!-- Footer -->
        <div id="footer-container"></div>

        <!-- Scripts -->
        <script src="../js/main.js"></script>
        <script>
            // Load navigation and footer
            loadNavbarAndInitialize();

            // Load cart page content
            document.addEventListener("DOMContentLoaded", function () {
                loadCartPage();
            });

            fetch("../common/components/footer.html")
                .then((response) => response.text())
                .then((data) => {
                    document.getElementById("footer-container").innerHTML =
                        data;
                });

            // Add sample books to cart for testing (you can remove this later)
            function addSampleBooksToCart() {
                const sampleBooks = [
                    {
                        id: 1,
                        title: "Clean Code",
                        author: "Robert C. Martin",
                        price: 45.99,
                        image: "https://via.placeholder.com/200x250/1e2a5a/ffffff?text=Clean+Code",
                        quantity: 1,
                    },
                    {
                        id: 2,
                        title: "The Pragmatic Programmer",
                        author: "David Thomas",
                        price: 42.5,
                        image: "https://via.placeholder.com/200x250/d4af37/ffffff?text=Pragmatic+Programmer",
                        quantity: 2,
                    },
                ];

                // Add sample books to cart if cart is empty
                let currentCart = JSON.parse(
                    localStorage.getItem("bookmarketCart") || "[]"
                );
                if (currentCart.length === 0) {
                    localStorage.setItem(
                        "bookmarketCart",
                        JSON.stringify(sampleBooks)
                    );
                    updateCartCount();
                }
            }

            // Initialize with sample data (remove this in production)
            addSampleBooksToCart();

            // Custom cart loading function for this page
            function loadCartPage() {
                const cart = JSON.parse(
                    localStorage.getItem("bookmarketCart") || "[]"
                );
                const cartItemsList =
                    document.getElementById("cart-items-list");
                const itemCount = document.getElementById("item-count");
                const cartContainer = document.getElementById("cart-container");
                const emptyCart = document.getElementById("empty-cart");
                const cartSummary = document.getElementById("cart-summary");

                if (cart.length === 0) {
                    cartContainer.style.display = "none";
                    emptyCart.style.display = "block";
                    return;
                }

                cartContainer.style.display = "grid";
                emptyCart.style.display = "none";
                itemCount.textContent = cart.length;

                // Load cart items
                cartItemsList.innerHTML = cart
                    .map(
                        (item) => `
                    <div class="cart-item" data-id="${item.id}">
                        <img src="${item.image}" alt="${
                            item.title
                        }" class="book-image" />
                        
                        <div class="book-details">
                            <div class="book-title">${item.title}</div>
                            <div class="book-author">by ${item.author}</div>
                            <div class="stock-status">
                                <i class="fas fa-check-circle"></i>
                                In Stock
                            </div>
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="updateQuantity(${
                                    item.id
                                }, -1)" ${item.quantity <= 1 ? "disabled" : ""}>
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span class="quantity-display">${
                                    item.quantity
                                }</span>
                                <button class="quantity-btn" onclick="updateQuantity(${
                                    item.id
                                }, 1)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>

                        <div class="item-price">
                            <div class="price-per-item">$${item.price.toFixed(
                                2
                            )} each</div>
                            <div class="total-price">$${(
                                item.price * item.quantity
                            ).toFixed(2)}</div>
                            <button class="remove-btn" onclick="removeFromCart(${
                                item.id
                            })" title="Remove from cart">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `
                    )
                    .join("");

                // Load cart summary
                loadCartSummary();
            }

            // Load cart summary
            function loadCartSummary() {
                const cart = JSON.parse(
                    localStorage.getItem("bookmarketCart") || "[]"
                );
                const cartSummary = document.getElementById("cart-summary");

                if (cart.length === 0) return;

                const subtotal = cart.reduce(
                    (sum, item) => sum + item.price * item.quantity,
                    0
                );
                const tax = subtotal * 0.08; // 8% tax
                const shipping = subtotal > 50 ? 0 : 5.99;
                const total = subtotal + tax + shipping;

                cartSummary.innerHTML = `
                    <h3 style="margin-bottom: 1.5rem; color: var(--primary-navy);">Order Summary</h3>
                    
                    <div class="summary-row">
                        <span>Subtotal (${cart.reduce(
                            (sum, item) => sum + item.quantity,
                            0
                        )} items)</span>
                        <span>$${subtotal.toFixed(2)}</span>
                    </div>
                    
                    <div class="summary-row">
                        <span>Tax</span>
                        <span>$${tax.toFixed(2)}</span>
                    </div>
                    
                    <div class="summary-row">
                        <span>Shipping</span>
                        <span>${
                            shipping === 0 ? "Free" : "$" + shipping.toFixed(2)
                        }</span>
                    </div>
                    
                    <div class="summary-row total">
                        <span>Total</span>
                        <span>$${total.toFixed(2)}</span>
                    </div>

                    <button class="btn btn-primary" style="width: 100%; margin: 1.5rem 0;" onclick="proceedToCheckout()">
                        <i class="fas fa-lock"></i>
                        Proceed to Checkout
                    </button>

                    <div class="payment-methods">
                        <div class="payment-icon">
                            <i class="fab fa-cc-visa" style="color: #1a1f71;"></i>
                        </div>
                        <div class="payment-icon">
                            <i class="fab fa-cc-mastercard" style="color: #eb001b;"></i>
                        </div>
                        <div class="payment-icon">
                            <i class="fab fa-cc-amex" style="color: #006fcf;"></i>
                        </div>
                        <div class="payment-icon">
                            <i class="fas fa-money-bill-wave" style="color: #28a745;"></i>
                            <span style="font-size: 0.7rem; margin-left: 0.25rem;">COD</span>
                        </div>
                    </div>

                    <p style="text-align: center; font-size: 0.9rem; color: var(--text-light); margin-top: 1rem;">
                        <i class="fas fa-shield-alt"></i>
                        Secure checkout powered by BookMarket
                    </p>
                `;
            }

            // Update quantity function
            function updateQuantity(itemId, change) {
                let cart = JSON.parse(
                    localStorage.getItem("bookmarketCart") || "[]"
                );
                const item = cart.find((item) => item.id === itemId);

                if (item) {
                    item.quantity += change;

                    // Remove item if quantity becomes 0 or less
                    if (item.quantity <= 0) {
                        cart = cart.filter(
                            (cartItem) => cartItem.id !== itemId
                        );
                        showAlert("Book removed from cart", "info");
                    } else {
                        showAlert("Quantity updated", "success");
                    }

                    localStorage.setItem(
                        "bookmarketCart",
                        JSON.stringify(cart)
                    );
                    updateCartCount();
                    loadCartPage();
                }
            }

            // Proceed to checkout
            function proceedToCheckout() {
                const cart = JSON.parse(
                    localStorage.getItem("bookmarketCart") || "[]"
                );
                if (cart.length === 0) {
                    showAlert("Your cart is empty", "error");
                    return;
                }

                showAlert("Redirecting to checkout...", "info");
                setTimeout(() => {
                    window.location.href = "checkout.html";
                }, 1500);
            }

            // Override the global removeFromCart function for this page
            function removeFromCart(itemId) {
                let cart = JSON.parse(
                    localStorage.getItem("bookmarketCart") || "[]"
                );
                cart = cart.filter((item) => item.id !== itemId);
                localStorage.setItem("bookmarketCart", JSON.stringify(cart));
                updateCartCount();
                loadCartPage();
                showAlert("Book removed from cart", "success");
            }

            // Override the global clearCart function for this page
            function clearCart() {
                localStorage.setItem("bookmarketCart", JSON.stringify([]));
                updateCartCount();
                loadCartPage();
                showAlert("Cart cleared", "success");
            }
        </script>
    </body>
</html>
