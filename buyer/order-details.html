<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Order Details - BookMarket</title>

        <!-- Google Fonts -->
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family:Lora:wght@400;500;600&display=swap"
            rel="stylesheet"
        />

        <!-- Font Awesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        />

        <!-- Custom CSS -->
        <link rel="stylesheet" href="../css/styles.css" />

        <style>
            .order-details-header {
                background: linear-gradient(
                    135deg,
                    var(--primary-navy) 0%,
                    #2c3e50 100%
                );
                color: white;
                padding: 2rem 0;
                text-align: center;
            }

            .order-status-timeline {
                background: white;
                padding: 2rem;
                border-radius: var(--border-radius);
                border: 1px solid var(--border-gray);
                margin: 2rem 0;
            }

            .timeline {
                position: relative;
                padding: 1rem 0;
            }

            .timeline::before {
                content: "";
                position: absolute;
                top: 0;
                left: 30px;
                height: 100%;
                width: 3px;
                background: var(--border-gray);
            }

            .timeline-item {
                position: relative;
                display: flex;
                align-items: center;
                gap: 1rem;
                margin-bottom: 2rem;
                padding-left: 2rem;
            }

            .timeline-item:last-child {
                margin-bottom: 0;
            }

            .timeline-icon {
                position: absolute;
                left: -2rem;
                width: 60px;
                height: 60px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.2rem;
                border: 3px solid white;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                z-index: 2;
            }

            .timeline-icon.completed {
                background: var(--success);
                color: white;
            }

            .timeline-icon.current {
                background: var(--secondary-gold);
                color: var(--primary-navy);
            }

            .timeline-icon.pending {
                background: var(--light-gray);
                color: var(--text-light);
            }

            .timeline-content {
                flex: 1;
            }

            .timeline-title {
                font-weight: 600;
                color: var(--primary-navy);
                margin-bottom: 0.25rem;
            }

            .timeline-date {
                color: var(--text-light);
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
            }

            .timeline-description {
                color: var(--text-dark);
                font-size: 0.9rem;
            }

            .order-summary {
                display: grid;
                grid-template-columns: 2fr 1fr;
                gap: 2rem;
                margin: 2rem 0;
            }

            .order-items-section {
                background: white;
                border: 1px solid var(--border-gray);
                border-radius: var(--border-radius);
                overflow: hidden;
            }

            .section-header {
                padding: 1.5rem;
                background: var(--light-gray);
                border-bottom: 1px solid var(--border-gray);
                font-weight: 600;
                color: var(--primary-navy);
            }

            .order-item {
                display: flex;
                align-items: center;
                gap: 1rem;
                padding: 1.5rem;
                border-bottom: 1px solid var(--border-gray);
            }

            .order-item:last-child {
                border-bottom: none;
            }

            .item-image {
                width: 80px;
                height: 100px;
                object-fit: cover;
                border-radius: var(--border-radius);
            }

            .item-details {
                flex: 1;
            }

            .item-title {
                font-weight: 600;
                color: var(--primary-navy);
                margin-bottom: 0.5rem;
            }

            .item-author {
                color: var(--text-light);
                margin-bottom: 0.5rem;
            }

            .item-specs {
                display: flex;
                gap: 1rem;
                font-size: 0.9rem;
                color: var(--text-light);
            }

            .item-price {
                text-align: right;
            }

            .price-main {
                font-size: 1.2rem;
                font-weight: bold;
                color: var(--secondary-gold);
                margin-bottom: 0.25rem;
            }

            .price-breakdown {
                font-size: 0.9rem;
                color: var(--text-light);
            }

            .order-sidebar {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
            }

            .info-card {
                background: white;
                border: 1px solid var(--border-gray);
                border-radius: var(--border-radius);
                overflow: hidden;
            }

            .info-card-header {
                padding: 1rem 1.5rem;
                background: var(--light-gray);
                border-bottom: 1px solid var(--border-gray);
                font-weight: 600;
                color: var(--primary-navy);
            }

            .info-card-content {
                padding: 1.5rem;
            }

            .order-total {
                display: flex;
                justify-content: space-between;
                margin-bottom: 0.5rem;
                font-size: 0.95rem;
            }

            .order-total.final {
                font-size: 1.2rem;
                font-weight: bold;
                color: var(--primary-navy);
                border-top: 2px solid var(--border-gray);
                padding-top: 0.5rem;
                margin-top: 0.5rem;
            }

            .address-info {
                line-height: 1.6;
                color: var(--text-dark);
            }

            .tracking-section {
                background: #f0f9ff;
                border: 1px solid #0ea5e9;
                border-radius: var(--border-radius);
                padding: 1.5rem;
                margin: 2rem 0;
            }

            .tracking-number {
                font-family: monospace;
                font-weight: bold;
                font-size: 1.1rem;
                color: var(--primary-navy);
                margin: 0.5rem 0;
            }

            .tracking-updates {
                margin-top: 1rem;
            }

            .tracking-update {
                display: flex;
                justify-content: space-between;
                padding: 0.75rem 0;
                border-bottom: 1px solid rgba(14, 165, 233, 0.2);
            }

            .tracking-update:last-child {
                border-bottom: none;
            }

            .action-buttons {
                display: flex;
                gap: 1rem;
                margin: 2rem 0;
                flex-wrap: wrap;
            }

            .support-section {
                background: #f9fafb;
                border: 1px solid var(--border-gray);
                border-radius: var(--border-radius);
                padding: 2rem;
                text-align: center;
                margin: 2rem 0;
            }

            @media (max-width: 768px) {
                .order-summary {
                    grid-template-columns: 1fr;
                }

                .timeline-item {
                    padding-left: 1rem;
                }

                .timeline-icon {
                    left: -1.5rem;
                    width: 50px;
                    height: 50px;
                    font-size: 1rem;
                }

                .timeline::before {
                    left: 25px;
                }

                .order-item {
                    flex-direction: column;
                    text-align: center;
                    gap: 1rem;
                }

                .item-price {
                    text-align: center;
                }

                .action-buttons {
                    flex-direction: column;
                }
            }
        </style>
    </head>
    <body>
        <!-- Navigation -->
        <div id="navbar-container"></div>

        <!-- Order Details Header -->
        <section class="order-details-header">
            <div class="container">
                <div
                    style="
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 1rem;
                        margin-bottom: 1rem;
                    "
                >
                    <a
                        href="order-history.html"
                        class="btn btn-outline"
                        style="color: white; border-color: white"
                    >
                        <i class="fas fa-arrow-left"></i>
                        Back to Orders
                    </a>
                    <h1 id="order-title">Order #ORD-2024-001</h1>
                </div>
                <p id="order-date">Placed on January 20, 2024</p>
            </div>
        </section>

        <!-- Main Content -->
        <main class="container" style="padding: 2rem 0">
            <!-- Order Status Timeline -->
            <div class="order-status-timeline">
                <h3 style="margin-bottom: 1.5rem; color: var(--primary-navy)">
                    <i class="fas fa-truck"></i>
                    Order Status & Tracking
                </h3>

                <div class="timeline" id="order-timeline">
                    <!-- Timeline will be loaded dynamically -->
                </div>
            </div>

            <!-- Tracking Information -->
            <div
                class="tracking-section"
                id="tracking-section"
                style="display: none"
            >
                <div
                    style="
                        display: flex;
                        align-items: center;
                        gap: 0.5rem;
                        margin-bottom: 1rem;
                    "
                >
                    <i
                        class="fas fa-truck"
                        style="color: #0ea5e9; font-size: 1.5rem"
                    ></i>
                    <h3 style="margin: 0; color: var(--primary-navy)">
                        Tracking Information
                    </h3>
                </div>

                <div>
                    <strong>Tracking Number:</strong>
                    <div class="tracking-number" id="tracking-number">
                        1Z999AA1234567890
                    </div>
                </div>

                <div class="tracking-updates" id="tracking-updates">
                    <!-- Tracking updates will be loaded dynamically -->
                </div>

                <div style="margin-top: 1rem">
                    <button
                        class="btn btn-primary"
                        onclick="openExternalTracking()"
                    >
                        <i class="fas fa-external-link-alt"></i>
                        Track on Carrier Website
                    </button>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="order-summary">
                <!-- Order Items -->
                <div class="order-items-section">
                    <div class="section-header">
                        <i class="fas fa-list"></i>
                        Order Items
                    </div>
                    <div id="order-items">
                        <!-- Items will be loaded dynamically -->
                    </div>
                </div>

                <!-- Order Info Sidebar -->
                <div class="order-sidebar">
                    <!-- Order Total -->
                    <div class="info-card">
                        <div class="info-card-header">
                            <i class="fas fa-calculator"></i>
                            Order Summary
                        </div>
                        <div class="info-card-content" id="order-totals">
                            <!-- Totals will be loaded dynamically -->
                        </div>
                    </div>

                    <!-- Shipping Address -->
                    <div class="info-card">
                        <div class="info-card-header">
                            <i class="fas fa-map-marker-alt"></i>
                            Shipping Address
                        </div>
                        <div class="info-card-content">
                            <div class="address-info" id="shipping-address">
                                <!-- Address will be loaded dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method -->
                    <div class="info-card">
                        <div class="info-card-header">
                            <i class="fas fa-credit-card"></i>
                            Payment Method
                        </div>
                        <div class="info-card-content">
                            <div id="payment-method">
                                <!-- Payment method will be loaded dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Order Actions -->
                    <div class="info-card">
                        <div class="info-card-header">
                            <i class="fas fa-cog"></i>
                            Actions
                        </div>
                        <div class="info-card-content">
                            <div
                                style="
                                    display: flex;
                                    flex-direction: column;
                                    gap: 0.75rem;
                                "
                                id="order-actions"
                            >
                                <!-- Actions will be loaded dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Support Section -->
            <div class="support-section">
                <h3 style="margin-bottom: 1rem; color: var(--primary-navy)">
                    <i class="fas fa-headset"></i>
                    Need Help?
                </h3>
                <p style="margin-bottom: 1.5rem; color: var(--text-light)">
                    Our customer support team is here to help with any questions
                    about your order.
                </p>
                <div
                    style="
                        display: flex;
                        gap: 1rem;
                        justify-content: center;
                        flex-wrap: wrap;
                    "
                >
                    <button class="btn btn-primary" onclick="contactSupport()">
                        <i class="fas fa-comments"></i>
                        Live Chat
                    </button>
                    <button class="btn btn-outline" onclick="emailSupport()">
                        <i class="fas fa-envelope"></i>
                        Email Support
                    </button>
                    <button class="btn btn-outline" onclick="callSupport()">
                        <i class="fas fa-phone"></i>
                        Call Support
                    </button>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <div id="footer-container"></div>

        <!-- Scripts -->
        <script src="../js/main.js"></script>
        <script>
            // Sample order data (would typically come from URL parameter or API)
            const orderData = {
                id: "ORD-2024-001",
                date: "2024-01-20",
                status: "delivered",
                total: 89.97,
                subtotal: 76.97,
                tax: 6.16,
                shipping: 6.84,
                discount: 0,
                items: [
                    {
                        title: "The Psychology of Money",
                        author: "Morgan Housel",
                        price: 22.99,
                        quantity: 1,
                        image: "https://via.placeholder.com/200x250/10b981/ffffff?text=Psychology",
                        condition: "New",
                        isbn: "978-0857197689",
                    },
                    {
                        title: "Atomic Habits",
                        author: "James Clear",
                        price: 18.99,
                        quantity: 2,
                        image: "https://via.placeholder.com/200x250/f97316/ffffff?text=Atomic+Habits",
                        condition: "New",
                        isbn: "978-1847941831",
                    },
                    {
                        title: "Clean Code",
                        author: "Robert C. Martin",
                        price: 29.99,
                        quantity: 1,
                        image: "https://via.placeholder.com/200x250/1e2a5a/ffffff?text=Clean+Code",
                        condition: "Used - Good",
                        isbn: "978-0132350884",
                    },
                ],
                shippingAddress: {
                    name: "John Doe",
                    address1: "123 Main Street",
                    address2: "Apt 4B",
                    city: "New York",
                    state: "NY",
                    zip: "10001",
                    country: "United States",
                    phone: "+1 (555) 123-4567",
                },
                paymentMethod: {
                    type: "Credit Card",
                    last4: "4242",
                    brand: "Visa",
                    expiry: "12/25",
                },
                trackingNumber: "1Z999AA1234567890",
                deliveryDate: "2024-01-25",
                timeline: [
                    {
                        status: "Order Placed",
                        date: "2024-01-20 10:30 AM",
                        description:
                            "Your order has been placed and payment confirmed.",
                        completed: true,
                    },
                    {
                        status: "Processing",
                        date: "2024-01-21 2:15 PM",
                        description:
                            "Your order is being prepared for shipment.",
                        completed: true,
                    },
                    {
                        status: "Shipped",
                        date: "2024-01-22 9:45 AM",
                        description:
                            "Your order has been shipped and is on its way.",
                        completed: true,
                    },
                    {
                        status: "Out for Delivery",
                        date: "2024-01-25 8:00 AM",
                        description: "Your package is out for delivery.",
                        completed: true,
                    },
                    {
                        status: "Delivered",
                        date: "2024-01-25 3:20 PM",
                        description:
                            "Your order has been delivered successfully.",
                        completed: true,
                    },
                ],
                trackingUpdates: [
                    {
                        status: "Delivered",
                        date: "Jan 25, 3:20 PM",
                        location: "New York, NY",
                    },
                    {
                        status: "Out for delivery",
                        date: "Jan 25, 8:00 AM",
                        location: "New York, NY",
                    },
                    {
                        status: "Arrived at facility",
                        date: "Jan 24, 11:30 PM",
                        location: "Brooklyn, NY",
                    },
                    {
                        status: "In transit",
                        date: "Jan 23, 6:15 AM",
                        location: "Philadelphia, PA",
                    },
                    {
                        status: "Shipped",
                        date: "Jan 22, 9:45 AM",
                        location: "Warehouse, NJ",
                    },
                ],
            };

            // Load navigation and footer
            loadNavbarAndInitialize();

            fetch("../common/components/footer.html")
                .then((response) => response.text())
                .then((data) => {
                    document.getElementById("footer-container").innerHTML =
                        data;
                });

            // Initialize order details
            document.addEventListener("DOMContentLoaded", function () {
                loadOrderDetails();
            });

            // Load order details
            function loadOrderDetails() {
                // Update header
                document.getElementById(
                    "order-title"
                ).textContent = `Order ${orderData.id}`;
                document.getElementById(
                    "order-date"
                ).textContent = `Placed on ${formatDate(orderData.date)}`;

                // Load timeline
                loadTimeline();

                // Load tracking info
                if (orderData.trackingNumber) {
                    loadTrackingInfo();
                }

                // Load order items
                loadOrderItems();

                // Load order totals
                loadOrderTotals();

                // Load shipping address
                loadShippingAddress();

                // Load payment method
                loadPaymentMethod();

                // Load order actions
                loadOrderActions();
            }

            // Load timeline
            function loadTimeline() {
                const timeline = document.getElementById("order-timeline");
                timeline.innerHTML = orderData.timeline
                    .map((item, index) => {
                        const isLast = index === orderData.timeline.length - 1;
                        const iconClass = item.completed
                            ? "completed"
                            : isLast
                            ? "current"
                            : "pending";
                        const icon = getTimelineIcon(item.status);

                        return `
                    <div class="timeline-item">
                        <div class="timeline-icon ${iconClass}">
                            <i class="fas fa-${icon}"></i>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-title">${item.status}</div>
                            <div class="timeline-date">${item.date}</div>
                            <div class="timeline-description">${item.description}</div>
                        </div>
                    </div>
                `;
                    })
                    .join("");
            }

            // Load tracking info
            function loadTrackingInfo() {
                const trackingSection =
                    document.getElementById("tracking-section");
                const trackingNumber =
                    document.getElementById("tracking-number");
                const trackingUpdates =
                    document.getElementById("tracking-updates");

                trackingSection.style.display = "block";
                trackingNumber.textContent = orderData.trackingNumber;

                trackingUpdates.innerHTML = orderData.trackingUpdates
                    .map(
                        (update) => `
                <div class="tracking-update">
                    <div>
                        <strong>${update.status}</strong><br>
                        <small style="color: var(--text-light);">${update.location}</small>
                    </div>
                    <div style="text-align: right; color: var(--text-light); font-size: 0.9rem;">
                        ${update.date}
                    </div>
                </div>
            `
                    )
                    .join("");
            }

            // Load order items
            function loadOrderItems() {
                const itemsContainer = document.getElementById("order-items");
                itemsContainer.innerHTML = orderData.items
                    .map(
                        (item) => `
                <div class="order-item">
                    <img src="${item.image}" alt="${
                            item.title
                        }" class="item-image">
                    <div class="item-details">
                        <div class="item-title">${item.title}</div>
                        <div class="item-author">by ${item.author}</div>
                        <div class="item-specs">
                            <span>Condition: ${item.condition}</span>
                            <span>ISBN: ${item.isbn}</span>
                            <span>Qty: ${item.quantity}</span>
                        </div>
                    </div>
                    <div class="item-price">
                        <div class="price-main">$${(
                            item.price * item.quantity
                        ).toFixed(2)}</div>
                        <div class="price-breakdown">$${item.price.toFixed(
                            2
                        )} each</div>
                    </div>
                </div>
            `
                    )
                    .join("");
            }

            // Load order totals
            function loadOrderTotals() {
                const totalsContainer = document.getElementById("order-totals");
                totalsContainer.innerHTML = `
                <div class="order-total">
                    <span>Subtotal:</span>
                    <span>$${orderData.subtotal.toFixed(2)}</span>
                </div>
                <div class="order-total">
                    <span>Tax:</span>
                    <span>$${orderData.tax.toFixed(2)}</span>
                </div>
                <div class="order-total">
                    <span>Shipping:</span>
                    <span>$${orderData.shipping.toFixed(2)}</span>
                </div>
                ${
                    orderData.discount > 0
                        ? `
                    <div class="order-total" style="color: var(--success);">
                        <span>Discount:</span>
                        <span>-$${orderData.discount.toFixed(2)}</span>
                    </div>
                `
                        : ""
                }
                <div class="order-total final">
                    <span>Total:</span>
                    <span>$${orderData.total.toFixed(2)}</span>
                </div>
            `;
            }

            // Load shipping address
            function loadShippingAddress() {
                const addressContainer =
                    document.getElementById("shipping-address");
                const addr = orderData.shippingAddress;
                addressContainer.innerHTML = `
                ${addr.name}<br>
                ${addr.address1}<br>
                ${addr.address2 ? addr.address2 + "<br>" : ""}
                ${addr.city}, ${addr.state} ${addr.zip}<br>
                ${addr.country}<br>
                <br>
                <strong>Phone:</strong> ${addr.phone}
            `;
            }

            // Load payment method
            function loadPaymentMethod() {
                const paymentContainer =
                    document.getElementById("payment-method");
                const payment = orderData.paymentMethod;
                paymentContainer.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <i class="fab fa-cc-${payment.brand.toLowerCase()}" style="font-size: 1.5rem; color: var(--primary-navy);"></i>
                    <span><strong>${payment.brand}</strong> ending in ${
                    payment.last4
                }</span>
                </div>
                <div style="color: var(--text-light); font-size: 0.9rem;">
                    Expires ${payment.expiry}
                </div>
            `;
            }

            // Load order actions
            function loadOrderActions() {
                const actionsContainer =
                    document.getElementById("order-actions");
                let actions = [];

                if (orderData.status === "delivered") {
                    actions.push(`
                    <button class="btn btn-primary btn-sm" onclick="reorderItems()">
                        <i class="fas fa-redo"></i>
                        Reorder Items
                    </button>
                `);
                    actions.push(`
                    <button class="btn btn-outline btn-sm" onclick="downloadInvoice()">
                        <i class="fas fa-download"></i>
                        Download Invoice
                    </button>
                `);
                }

                if (orderData.status === "pending") {
                    actions.push(`
                    <button class="btn btn-outline btn-sm" style="color: var(--error); border-color: var(--error);" onclick="cancelOrder()">
                        <i class="fas fa-times"></i>
                        Cancel Order
                    </button>
                `);
                }

                actions.push(`
                <button class="btn btn-outline btn-sm" onclick="printOrder()">
                    <i class="fas fa-print"></i>
                    Print Order
                </button>
            `);

                actionsContainer.innerHTML = actions.join("");
            }

            // Helper functions
            function getTimelineIcon(status) {
                const icons = {
                    "Order Placed": "check",
                    Processing: "cog",
                    Shipped: "truck",
                    "Out for Delivery": "shipping-fast",
                    Delivered: "check-circle",
                };
                return icons[status] || "circle";
            }

            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString("en-US", {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                });
            }

            // Action functions
            function openExternalTracking() {
                showAlert("Opening carrier tracking website...", "info");
            }

            function reorderItems() {
                orderData.items.forEach((item) => {
                    for (let i = 0; i < item.quantity; i++) {
                        addToCart(
                            Date.now() + Math.random(),
                            item.title,
                            item.author,
                            item.price,
                            item.image
                        );
                    }
                });
                showAlert("Items added to cart for reorder", "success");
            }

            function downloadInvoice() {
                showAlert("Invoice download would start here", "info");
            }

            function cancelOrder() {
                if (true) {
                    showAlert(
                        "Order cancellation request submitted",
                        "success"
                    );
                }
            }

            function printOrder() {
                window.print();
            }

            function contactSupport() {
                showAlert("Opening live chat...", "info");
            }

            function emailSupport() {
                window.location.href = `mailto:support@bookmarket.com?subject=Order ${orderData.id} - Support Request`;
            }

            function callSupport() {
                showAlert("Call: 1-800-BOOKMARKET (1-800-266-5627)", "info");
            }
        </script>
    </body>
</html>
