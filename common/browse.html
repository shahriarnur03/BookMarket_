<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Browse Books - BookMarket</title>
        <meta
            name="description"
            content="Browse and search thousands of books on BookMarket. Filter by category, condition, price and more."
        />

        <!-- CSS -->
        <link rel="stylesheet" href="../css/styles.css" />

        <!-- FontAwesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />

        <!-- Favicon -->
        <link rel="icon" type="image/x-icon" href="../assets/img/favicon.ico" />
    </head>
    <body>
        <!-- Navigation -->
        <div id="navbar-container"></div>

        <!-- Main Content -->
        <main style="padding-top: 100px; min-height: 100vh">
            <div class="container">
                <!-- Page Header -->
                <div class="text-center mb-4" style="padding: 2rem 0">
                    <h1>Browse Our Book Collection</h1>
                    <p
                        style="
                            font-size: 1.1rem;
                            color: var(--text-light);
                            max-width: 600px;
                            margin: 0 auto;
                        "
                    >
                        Discover your next favorite book from our extensive
                        collection. Use our advanced filters to find exactly
                        what you're looking for.
                    </p>
                </div>

                <!-- Search Bar -->
                <div class="search-bar">
                    <i class="fas fa-search search-icon"></i>
                    <input
                        type="text"
                        id="searchInput"
                        class="search-input"
                        placeholder="Search for books, authors, or ISBN..."
                    />
                </div>

                <!-- Filters Section -->
                <div class="filters">
                    <h3
                        style="
                            margin-bottom: 1.5rem;
                            color: var(--primary-navy);
                        "
                    >
                        <i class="fas fa-filter"></i>
                        Filter Books
                    </h3>

                    <div class="filters-row">
                        <div class="filter-group">
                            <label for="categoryFilter" class="form-label"
                                >Category</label
                            >
                            <select id="categoryFilter" class="form-select">
                                <option value="">All Categories</option>
                                <option value="fiction">Fiction</option>
                                <option value="academic">Academic</option>
                                <option value="business">Business</option>
                                <option value="science">
                                    Science & Technology
                                </option>
                                <option value="children">
                                    Children's Books
                                </option>
                                <option value="history">History</option>
                                <option value="self-help">Self Help</option>
                                <option value="biography">Biography</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label for="conditionFilter" class="form-label"
                                >Condition</label
                            >
                            <select id="conditionFilter" class="form-select">
                                <option value="">Any Condition</option>
                                <option value="new">New</option>
                                <option value="used">Used</option>
                                <option value="excellent">Excellent</option>
                                <option value="good">Good</option>
                                <option value="fair">Fair</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label for="priceFilter" class="form-label"
                                >Price Range</label
                            >
                            <select id="priceFilter" class="form-select">
                                <option value="">Any Price</option>
                                <option value="0-10">Under $10</option>
                                <option value="10-25">$10 - $25</option>
                                <option value="25-50">$25 - $50</option>
                                <option value="50-100">$50 - $100</option>
                                <option value="100">$100+</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label for="sortFilter" class="form-label"
                                >Sort By</label
                            >
                            <select id="sortFilter" class="form-select">
                                <option value="">Relevance</option>
                                <option value="price-low">
                                    Price: Low to High
                                </option>
                                <option value="price-high">
                                    Price: High to Low
                                </option>
                                <option value="title">Title: A to Z</option>
                                <option value="newest">Newest First</option>
                                <option value="rating">Highest Rated</option>
                            </select>
                        </div>

                        <div
                            class="filter-group"
                            style="display: flex; align-items: end"
                        >
                            <button
                                type="button"
                                class="btn btn-outline"
                                onclick="clearFilters()"
                            >
                                <i class="fas fa-times"></i>
                                Clear Filters
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Results Summary -->
                <div class="d-flex justify-between align-center mb-3">
                    <div>
                        <span
                            id="resultsCount"
                            style="color: var(--text-light); font-weight: 500"
                        >
                            Showing all books
                        </span>
                    </div>
                    <div class="d-flex align-center gap-2">
                        <span style="color: var(--text-light)">View:</span>
                        <button
                            class="btn btn-sm"
                            id="gridView"
                            onclick="setView('grid')"
                            style="
                                background: var(--primary-navy);
                                color: white;
                            "
                        >
                            <i class="fas fa-th"></i>
                        </button>
                        <button
                            class="btn btn-sm btn-outline"
                            id="listView"
                            onclick="setView('list')"
                        >
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>

                <!-- Books Grid -->
                <div class="books-container grid grid-4" id="booksContainer">
                    <!-- Books will be loaded here via JavaScript -->
                </div>

                <!-- No Results Message -->
                <div
                    id="noResults"
                    class="text-center"
                    style="display: none; padding: 3rem 0"
                >
                    <div
                        style="
                            font-size: 3rem;
                            color: var(--text-light);
                            margin-bottom: 1rem;
                        "
                    >
                        <i class="fas fa-search"></i>
                    </div>
                    <h3 style="color: var(--text-light); margin-bottom: 1rem">
                        No books found
                    </h3>
                    <p style="color: var(--text-light); margin-bottom: 2rem">
                        Try adjusting your search criteria or browse our
                        categories.
                    </p>
                    <a href="browse.html" class="btn btn-primary">
                        <i class="fas fa-refresh"></i>
                        Show All Books
                    </a>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="pagination">
                    <a href="#" class="pagination-btn" data-page="prev">
                        <i class="fas fa-chevron-left"></i>
                        Previous
                    </a>
                    <a href="#" class="pagination-btn active" data-page="1"
                        >1</a
                    >
                    <a href="#" class="pagination-btn" data-page="2">2</a>
                    <a href="#" class="pagination-btn" data-page="3">3</a>
                    <a href="#" class="pagination-btn" data-page="next">
                        Next
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <div id="footer-container"></div>

        <!-- JavaScript -->
        <script src="../js/main.js"></script>
        <script>
            // Load navigation and footer with proper auth state
            loadNavbarAndInitialize();

            fetch("../components/footer.html")
                .then((response) => response.text())
                .then((data) => {
                    document.getElementById("footer-container").innerHTML =
                        data;
                });

            // Extended sample books for browse page
            const allBooks = [
                ...(window.sampleBooks || []),
                {
                    id: 7,
                    title: "The Psychology of Money",
                    author: "Morgan Housel",
                    price: 22.99,
                    category: "business",
                    condition: "new",
                    rating: 4.4,
                    image: "https://via.placeholder.com/200x250/1e2a5a/ffffff?text=Psychology+of+Money",
                },
                {
                    id: 8,
                    title: "Atomic Habits",
                    author: "James Clear",
                    price: 16.99,
                    category: "self-help",
                    condition: "new",
                    rating: 4.7,
                    image: "https://via.placeholder.com/200x250/d4af37/ffffff?text=Atomic+Habits",
                },
                {
                    id: 9,
                    title: "The Alchemist",
                    author: "Paulo Coelho",
                    price: 13.99,
                    category: "fiction",
                    condition: "used",
                    rating: 4.6,
                    image: "https://via.placeholder.com/200x250/1e2a5a/ffffff?text=The+Alchemist",
                },
                {
                    id: 10,
                    title: "Data Structures and Algorithms in Java",
                    author: "Robert Lafore",
                    price: 95.99,
                    category: "academic",
                    condition: "new",
                    rating: 4.2,
                    image: "https://via.placeholder.com/200x250/d4af37/ffffff?text=Data+Structures",
                },
                {
                    id: 11,
                    title: "Steve Jobs",
                    author: "Walter Isaacson",
                    price: 19.99,
                    category: "biography",
                    condition: "used",
                    rating: 4.8,
                    image: "https://via.placeholder.com/200x250/1e2a5a/ffffff?text=Steve+Jobs",
                },
                {
                    id: 12,
                    title: "The Cat in the Hat",
                    author: "Dr. Seuss",
                    price: 8.99,
                    category: "children",
                    condition: "good",
                    rating: 4.9,
                    image: "https://via.placeholder.com/200x250/d4af37/ffffff?text=Cat+in+Hat",
                },
                {
                    id: 13,
                    title: "A Brief History of Time",
                    author: "Stephen Hawking",
                    price: 17.99,
                    category: "science",
                    condition: "used",
                    rating: 4.5,
                    image: "https://via.placeholder.com/200x250/1e2a5a/ffffff?text=Brief+History",
                },
                {
                    id: 14,
                    title: "The World War II",
                    author: "Winston Churchill",
                    price: 24.99,
                    category: "history",
                    condition: "excellent",
                    rating: 4.7,
                    image: "https://via.placeholder.com/200x250/d4af37/ffffff?text=World+War+II",
                },
                {
                    id: 15,
                    title: "Think and Grow Rich",
                    author: "Napoleon Hill",
                    price: 14.99,
                    category: "self-help",
                    condition: "new",
                    rating: 4.3,
                    image: "https://via.placeholder.com/200x250/1e2a5a/ffffff?text=Think+Grow+Rich",
                },
            ];

            // Clear filters function
            function clearFilters() {
                document.getElementById("searchInput").value = "";
                document.getElementById("categoryFilter").value = "";
                document.getElementById("conditionFilter").value = "";
                document.getElementById("priceFilter").value = "";
                document.getElementById("sortFilter").value = "";

                loadBooks();
                updateResultsCount();
            }

            // Set view mode
            function setView(viewType) {
                const container = document.getElementById("booksContainer");
                const gridBtn = document.getElementById("gridView");
                const listBtn = document.getElementById("listView");

                if (viewType === "grid") {
                    container.className = "books-container grid grid-4";
                    gridBtn.className = "btn btn-sm";
                    gridBtn.style.background = "var(--primary-navy)";
                    gridBtn.style.color = "white";
                    listBtn.className = "btn btn-sm btn-outline";
                    listBtn.style.background = "";
                    listBtn.style.color = "";
                } else {
                    container.className = "books-container";
                    container.style.display = "flex";
                    container.style.flexDirection = "column";
                    container.style.gap = "1rem";
                    listBtn.className = "btn btn-sm";
                    listBtn.style.background = "var(--primary-navy)";
                    listBtn.style.color = "white";
                    gridBtn.className = "btn btn-sm btn-outline";
                    gridBtn.style.background = "";
                    gridBtn.style.color = "";
                }
            }

            // Load books into container
            function loadBooks() {
                const container = document.getElementById("booksContainer");
                const noResults = document.getElementById("noResults");

                if (allBooks && allBooks.length > 0) {
                    container.innerHTML = allBooks
                        .map((book) => generateBookCard(book))
                        .join("");
                    container.style.display = "grid";
                    noResults.style.display = "none";
                } else {
                    container.style.display = "none";
                    noResults.style.display = "block";
                }
            }

            // Update results count
            function updateResultsCount() {
                const resultsCount = document.getElementById("resultsCount");
                const visibleBooks = document.querySelectorAll(
                    '.book-card[style*="display: block"], .book-card:not([style*="display: none"])'
                );
                const total = allBooks.length;
                const visible = visibleBooks.length;

                if (visible === total) {
                    resultsCount.textContent = `Showing all ${total} books`;
                } else {
                    resultsCount.textContent = `Showing ${visible} of ${total} books`;
                }
            }

            // Handle URL parameters for category filtering
            function handleURLParams() {
                const urlParams = new URLSearchParams(window.location.search);
                const category = urlParams.get("category");

                if (category) {
                    document.getElementById("categoryFilter").value = category;
                }
            }

            // Initialize page
            document.addEventListener("DOMContentLoaded", function () {
                handleURLParams();
                loadBooks();
                updateResultsCount();

                // Override the filter function to also update results count
                const originalApplyFilters = window.initializeFilters;
                if (originalApplyFilters) {
                    originalApplyFilters();

                    // Add event listeners to update count after filtering
                    const filters = [
                        "categoryFilter",
                        "conditionFilter",
                        "priceFilter",
                        "sortFilter",
                        "searchInput",
                    ];
                    filters.forEach((filterId) => {
                        const element = document.getElementById(filterId);
                        if (element) {
                            element.addEventListener("change", () => {
                                setTimeout(updateResultsCount, 100);
                            });
                            if (filterId === "searchInput") {
                                element.addEventListener("input", () => {
                                    setTimeout(updateResultsCount, 300);
                                });
                            }
                        }
                    });
                }
            });

            // Pagination functionality
            document.addEventListener("DOMContentLoaded", function () {
                const paginationBtns =
                    document.querySelectorAll(".pagination-btn");

                paginationBtns.forEach((btn) => {
                    btn.addEventListener("click", function (e) {
                        e.preventDefault();

                        // Remove active class from all buttons
                        paginationBtns.forEach((b) =>
                            b.classList.remove("active")
                        );

                        // Add active class to clicked button (if it's a number)
                        const page = this.dataset.page;
                        if (!isNaN(page)) {
                            this.classList.add("active");
                        }

                        // Scroll to top
                        window.scrollTo({ top: 0, behavior: "smooth" });
                    });
                });
            });
        </script>
    </body>
</html>
