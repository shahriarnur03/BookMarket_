<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Admin Profile - Admin Dashboard - BookMarket</title>
        <link rel="stylesheet" href="../../css/styles.css" />
        <style>
            .dashboard-container {
                max-width: var(--container-width);
                margin: 2rem auto;
                padding: 0 1rem;
            }
            .dashboard-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 2rem;
                flex-wrap: wrap;
                gap: 1rem;
            }
            .welcome-message h1 {
                margin-bottom: 0.5rem;
                color: var(--dark-color);
            }
            .welcome-message p {
                color: #666;
            }
            .dashboard-layout {
                display: flex;
                gap: 2rem;
            }
            .dashboard-sidebar {
                width: 250px;
                flex-shrink: 0;
            }
            .dashboard-content {
                flex: 1;
            }
            .sidebar-menu {
                background-color: #2c3e50;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            .sidebar-menu-item {
                padding: 1rem 1.5rem;
                display: flex;
                align-items: center;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                cursor: pointer;
                transition: all 0.3s ease;
                color: white;
                text-decoration: none;
            }
            .sidebar-menu-item:last-child {
                border-bottom: none;
            }
            .sidebar-menu-item.active {
                background-color: var(--primary-color);
            }
            .sidebar-menu-item:hover:not(.active) {
                background-color: rgba(255, 255, 255, 0.1);
            }
            .sidebar-menu-item i {
                margin-right: 0.8rem;
                width: 20px;
                text-align: center;
            }
            .section-card {
                background-color: white;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                margin-bottom: 2rem;
            }
            .section-header {
                padding: 1rem 1.5rem;
                border-bottom: 1px solid var(--border-color);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .section-title {
                margin: 0;
                font-size: 1.2rem;
                color: var(--dark-color);
            }
            .section-content {
                padding: 1.5rem;
            }
            .profile-header {
                display: flex;
                align-items: center;
                margin-bottom: 2rem;
            }
            .profile-avatar {
                width: 100px;
                height: 100px;
                border-radius: 50%;
                background-color: #f0f0f0;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 2.5rem;
                color: #aaa;
                margin-right: 1.5rem;
                overflow: hidden;
            }
            .profile-info h2 {
                margin-bottom: 0.5rem;
                color: var(--dark-color);
            }
            .profile-info p {
                color: #666;
                margin-bottom: 0.5rem;
            }
            .profile-info .member-since {
                font-size: 0.9rem;
                color: #888;
            }
            .profile-tabs {
                display: flex;
                border-bottom: 1px solid var(--border-color);
                margin-bottom: 1.5rem;
            }
            .profile-tab {
                padding: 1rem 1.5rem;
                cursor: pointer;
                font-weight: 600;
                color: var(--dark-color);
                position: relative;
            }
            .profile-tab.active {
                color: var(--primary-color);
            }
            .profile-tab.active::after {
                content: "";
                position: absolute;
                bottom: -1px;
                left: 0;
                width: 100%;
                height: 2px;
                background-color: var(--primary-color);
            }
            .profile-content {
                display: none;
            }
            .profile-content.active {
                display: block;
            }
            .form-group {
                margin-bottom: 1.5rem;
            }
            .form-group label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: 600;
                color: var(--dark-color);
            }
            .form-group input,
            .form-group textarea,
            .form-group select {
                width: 100%;
                padding: 0.8rem;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                font-size: 1rem;
            }
            .form-row {
                display: flex;
                gap: 1.5rem;
                margin-bottom: 1.5rem;
            }
            .form-row .form-group {
                flex: 1;
                margin-bottom: 0;
            }
            .form-buttons {
                display: flex;
                justify-content: flex-end;
                gap: 1rem;
                margin-top: 2rem;
            }
            .danger-zone {
                margin-top: 3rem;
                padding: 1.5rem;
                border: 1px solid var(--danger-color);
                border-radius: 8px;
                background-color: rgba(231, 76, 60, 0.05);
            }
            .danger-zone h3 {
                color: var(--danger-color);
                margin-bottom: 1rem;
            }
            .danger-zone p {
                margin-bottom: 1.5rem;
                color: #666;
            }
            @media screen and (max-width: 992px) {
                .dashboard-layout {
                    flex-direction: column;
                }
                .dashboard-sidebar {
                    width: 100%;
                }
            }
            @media screen and (max-width: 768px) {
                .profile-header {
                    flex-direction: column;
                    text-align: center;
                }
                .profile-avatar {
                    margin-right: 0;
                    margin-bottom: 1rem;
                }
                .form-row {
                    flex-direction: column;
                    gap: 1.5rem;
                }
            }
        </style>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
    </head>
    <body>
        <nav class="navbar"></nav>

        <div class="dashboard-container">
            <div class="dashboard-header">
                <div class="welcome-message">
                    <h1>Admin Profile</h1>
                    <p>Manage your admin account settings and preferences</p>
                </div>
            </div>

            <div class="dashboard-layout">
                <div class="dashboard-sidebar">
                    <div class="sidebar-menu">
                        <a href="dashboard.html" class="sidebar-menu-item">
                            <i class="fas fa-chart-line"></i> Dashboard
                        </a>
                        <a
                            href="order-management.html"
                            class="sidebar-menu-item"
                        >
                            <i class="fas fa-shopping-bag"></i> Order Management
                        </a>
                        <a
                            href="book-management.html"
                            class="sidebar-menu-item"
                        >
                            <i class="fas fa-book"></i> Book Management
                        </a>
                        <a
                            href="user-management.html"
                            class="sidebar-menu-item"
                        >
                            <i class="fas fa-users"></i> User Management
                        </a>
                        <a href="book-upload.html" class="sidebar-menu-item">
                            <i class="fas fa-upload"></i> Book Upload
                        </a>
                        <a href="book-approval.html" class="sidebar-menu-item">
                            <i class="fas fa-check-circle"></i> Book Approval
                        </a>
                        <a href="sales-reports.html" class="sidebar-menu-item">
                            <i class="fas fa-dollar-sign"></i> Sales Reports
                        </a>
                        <a href="profile.html" class="sidebar-menu-item active">
                            <i class="fas fa-user"></i> My Profile
                        </a>
                        <a
                            href="#"
                            class="sidebar-menu-item"
                            id="sidebar-logout"
                        >
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>

                <div class="dashboard-content">
                    <div class="section-card">
                        <div class="section-header">
                            <h3 class="section-title">Profile Information</h3>
                        </div>

                        <div class="section-content">
                            <div class="profile-header">
                                <div class="profile-avatar">
                                    <i class="fas fa-user-shield"></i>
                                </div>
                                <div class="profile-info">
                                    <h2 id="profile-name">Loading...</h2>
                                    <p id="profile-email">Loading...</p>
                                    <p id="profile-phone">Loading...</p>
                                    <p class="member-since">
                                        Admin since:
                                        <span id="profile-joined"
                                            >Loading...</span
                                        >
                                    </p>
                                </div>
                            </div>

                            <div class="profile-tabs">
                                <div
                                    class="profile-tab active"
                                    data-tab="personal-info"
                                >
                                    Personal Information
                                </div>
                                <div
                                    class="profile-tab"
                                    data-tab="change-password"
                                >
                                    Change Password
                                </div>
                                <div
                                    class="profile-tab"
                                    data-tab="admin-settings"
                                >
                                    Admin Settings
                                </div>
                                <div class="profile-tab" data-tab="preferences">
                                    Preferences
                                </div>
                            </div>

                            <div
                                class="profile-content active"
                                id="personal-info-content"
                            >
                                <form id="personal-info-form">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="first-name"
                                                >First Name</label
                                            >
                                            <input
                                                type="text"
                                                id="first-name"
                                                value=""
                                            />
                                        </div>
                                        <div class="form-group">
                                            <label for="last-name"
                                                >Last Name</label
                                            >
                                            <input
                                                type="text"
                                                id="last-name"
                                                value=""
                                            />
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="email">Email</label>
                                            <input
                                                type="email"
                                                id="email"
                                                value=""
                                                readonly
                                            />
                                        </div>
                                        <div class="form-group">
                                            <label for="phone"
                                                >Phone Number</label
                                            >
                                            <input
                                                type="tel"
                                                id="phone"
                                                value=""
                                            />
                                        </div>
                                    </div>
                                    <div class="form-buttons">
                                        <button
                                            type="submit"
                                            class="btn btn-primary"
                                        >
                                            Save Changes
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <div
                                class="profile-content"
                                id="change-password-content"
                            >
                                <form id="change-password-form">
                                    <div class="form-group">
                                        <label for="current-password"
                                            >Current Password</label
                                        >
                                        <input
                                            type="password"
                                            id="current-password"
                                            required
                                        />
                                    </div>
                                    <div class="form-group">
                                        <label for="new-password"
                                            >New Password</label
                                        >
                                        <input
                                            type="password"
                                            id="new-password"
                                            required
                                        />
                                    </div>
                                    <div class="form-group">
                                        <label for="confirm-password"
                                            >Confirm New Password</label
                                        >
                                        <input
                                            type="password"
                                            id="confirm-password"
                                            required
                                        />
                                    </div>
                                    <div class="form-buttons">
                                        <button
                                            type="submit"
                                            class="btn btn-primary"
                                        >
                                            Change Password
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <div
                                class="profile-content"
                                id="admin-settings-content"
                            >
                                <form id="admin-settings-form">
                                    <div class="form-group">
                                        <label for="admin-role"
                                            >Admin Role</label
                                        >
                                        <select id="admin-role">
                                            <option value="super_admin">
                                                Super Admin
                                            </option>
                                            <option value="admin">Admin</option>
                                            <option value="moderator">
                                                Moderator
                                            </option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Permissions</label>
                                        <div style="margin-top: 0.5rem">
                                            <div
                                                style="
                                                    display: flex;
                                                    align-items: center;
                                                    margin-bottom: 0.5rem;
                                                "
                                            >
                                                <input
                                                    type="checkbox"
                                                    id="perm-users"
                                                    checked
                                                    style="
                                                        width: auto;
                                                        margin-right: 0.5rem;
                                                    "
                                                />
                                                <label
                                                    for="perm-users"
                                                    style="font-weight: normal"
                                                    >User Management</label
                                                >
                                            </div>
                                            <div
                                                style="
                                                    display: flex;
                                                    align-items: center;
                                                    margin-bottom: 0.5rem;
                                                "
                                            >
                                                <input
                                                    type="checkbox"
                                                    id="perm-books"
                                                    checked
                                                    style="
                                                        width: auto;
                                                        margin-right: 0.5rem;
                                                    "
                                                />
                                                <label
                                                    for="perm-books"
                                                    style="font-weight: normal"
                                                    >Book Management</label
                                                >
                                            </div>
                                            <div
                                                style="
                                                    display: flex;
                                                    align-items: center;
                                                    margin-bottom: 0.5rem;
                                                "
                                            >
                                                <input
                                                    type="checkbox"
                                                    id="perm-orders"
                                                    checked
                                                    style="
                                                        width: auto;
                                                        margin-right: 0.5rem;
                                                    "
                                                />
                                                <label
                                                    for="perm-orders"
                                                    style="font-weight: normal"
                                                    >Order Management</label
                                                >
                                            </div>
                                            <div
                                                style="
                                                    display: flex;
                                                    align-items: center;
                                                    margin-bottom: 0.5rem;
                                                "
                                            >
                                                <input
                                                    type="checkbox"
                                                    id="perm-reports"
                                                    checked
                                                    style="
                                                        width: auto;
                                                        margin-right: 0.5rem;
                                                    "
                                                />
                                                <label
                                                    for="perm-reports"
                                                    style="font-weight: normal"
                                                    >Sales Reports</label
                                                >
                                            </div>
                                            <div
                                                style="
                                                    display: flex;
                                                    align-items: center;
                                                "
                                            >
                                                <input
                                                    type="checkbox"
                                                    id="perm-settings"
                                                    checked
                                                    style="
                                                        width: auto;
                                                        margin-right: 0.5rem;
                                                    "
                                                />
                                                <label
                                                    for="perm-settings"
                                                    style="font-weight: normal"
                                                    >System Settings</label
                                                >
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-buttons">
                                        <button
                                            type="submit"
                                            class="btn btn-primary"
                                        >
                                            Save Admin Settings
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <div
                                class="profile-content"
                                id="preferences-content"
                            >
                                <form id="preferences-form">
                                    <div class="form-group">
                                        <label>Email Notifications</label>
                                        <div style="margin-top: 0.5rem">
                                            <div
                                                style="
                                                    display: flex;
                                                    align-items: center;
                                                    margin-bottom: 0.5rem;
                                                "
                                            >
                                                <input
                                                    type="checkbox"
                                                    id="notify-orders"
                                                    checked
                                                    style="
                                                        width: auto;
                                                        margin-right: 0.5rem;
                                                    "
                                                />
                                                <label
                                                    for="notify-orders"
                                                    style="font-weight: normal"
                                                    >Order Updates</label
                                                >
                                            </div>
                                            <div
                                                style="
                                                    display: flex;
                                                    align-items: center;
                                                    margin-bottom: 0.5rem;
                                                "
                                            >
                                                <input
                                                    type="checkbox"
                                                    id="notify-approvals"
                                                    checked
                                                    style="
                                                        width: auto;
                                                        margin-right: 0.5rem;
                                                    "
                                                />
                                                <label
                                                    for="notify-approvals"
                                                    style="font-weight: normal"
                                                    >Book Approval
                                                    Requests</label
                                                >
                                            </div>
                                            <div
                                                style="
                                                    display: flex;
                                                    align-items: center;
                                                    margin-bottom: 0.5rem;
                                                "
                                            >
                                                <input
                                                    type="checkbox"
                                                    id="notify-users"
                                                    checked
                                                    style="
                                                        width: auto;
                                                        margin-right: 0.5rem;
                                                    "
                                                />
                                                <label
                                                    for="notify-users"
                                                    style="font-weight: normal"
                                                    >User Registration</label
                                                >
                                            </div>
                                            <div
                                                style="
                                                    display: flex;
                                                    align-items: center;
                                                "
                                            >
                                                <input
                                                    type="checkbox"
                                                    id="notify-system"
                                                    checked
                                                    style="
                                                        width: auto;
                                                        margin-right: 0.5rem;
                                                    "
                                                />
                                                <label
                                                    for="notify-system"
                                                    style="font-weight: normal"
                                                    >System Alerts</label
                                                >
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="language">Language</label>
                                        <select id="language">
                                            <option value="english" selected>
                                                English
                                            </option>
                                            <option value="bengali">
                                                Bengali
                                            </option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="timezone">Timezone</label>
                                        <select id="timezone">
                                            <option value="Asia/Dhaka" selected>
                                                Asia/Dhaka (UTC+6)
                                            </option>
                                            <option value="UTC">
                                                UTC (UTC+0)
                                            </option>
                                            <option value="America/New_York">
                                                America/New_York (UTC-5)
                                            </option>
                                            <option value="Europe/London">
                                                Europe/London (UTC+0)
                                            </option>
                                        </select>
                                    </div>
                                    <div class="form-buttons">
                                        <button
                                            type="submit"
                                            class="btn btn-primary"
                                        >
                                            Save Preferences
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <div class="danger-zone">
                                <h3>
                                    <i class="fas fa-exclamation-triangle"></i>
                                    Danger Zone
                                </h3>
                                <p>
                                    Once you delete your admin account, there is
                                    no going back. Please be certain.
                                </p>
                                <button
                                    class="btn btn-danger"
                                    id="delete-account-btn"
                                >
                                    Delete Admin Account
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <div class="footer-container">
                <div class="footer-top">
                    <div class="footer-column">
                        <h3>BookMarket</h3>
                        <p>
                            Your one-stop destination for buying and selling
                            books online.
                        </p>
                    </div>
                    <div class="footer-column">
                        <h3>Quick Links</h3>
                        <ul class="footer-links">
                            <li><a href="../../index.html">Home</a></li>
                            <li>
                                <a href="order-management.html"
                                    >Order Management</a
                                >
                            </li>
                            <li>
                                <a href="book-management.html"
                                    >Book Management</a
                                >
                            </li>
                            <li>
                                <a href="user-management.html"
                                    >User Management</a
                                >
                            </li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h3>Contact</h3>
                        <ul class="contact-info">
                            <li>
                                <i class="fas fa-envelope"></i>
                                admin@bookmarket.com
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2023 BookMarket. All Rights Reserved.</p>
                </div>
            </div>
        </footer>

        <script src="../../js/main.js"></script>
        <script src="../../js/auth.js"></script>
        <script src="../../js/admin-navbar.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                console.log("DOM Content Loaded - Admin Profile Page");

                // Check if admin is logged in
                let isAdminLoggedIn = false;
                let adminId = null;

                if (
                    window.bookmarketAuth &&
                    window.bookmarketAuth.isLoggedIn()
                ) {
                    isAdminLoggedIn = true;
                    adminId = window.bookmarketAuth.getUserId();
                }

                if (!isAdminLoggedIn) {
                    const bookmarketUser =
                        localStorage.getItem("bookmarket_user");
                    if (bookmarketUser) {
                        try {
                            const userData = JSON.parse(bookmarketUser);
                            if (userData.userId) {
                                isAdminLoggedIn = true;
                                adminId = userData.userId;
                            }
                        } catch (e) {
                            console.error(
                                "Error parsing localStorage data:",
                                e
                            );
                        }
                    }
                }

                if (!isAdminLoggedIn || !adminId) {
                    console.log("Admin not logged in, redirecting to login");
                    window.location.href = "login.html";
                    return;
                }

                // Load profile data
                loadProfileData(adminId);

                // Logout functionality
                const sidebarLogoutBtn =
                    document.getElementById("sidebar-logout");
                if (sidebarLogoutBtn) {
                    sidebarLogoutBtn.addEventListener("click", function (e) {
                        e.preventDefault();
                        if (
                            window.bookmarketAuth &&
                            typeof window.bookmarketAuth.logoutUser ===
                                "function"
                        ) {
                            window.bookmarketAuth.logoutUser();
                        } else {
                            localStorage.removeItem("bookmarket_user");
                            window.location.href = "../../index.html";
                        }
                    });
                }

                // Profile Tabs
                const profileTabs = document.querySelectorAll(".profile-tab");
                const profileContents =
                    document.querySelectorAll(".profile-content");

                profileTabs.forEach((tab) => {
                    tab.addEventListener("click", function () {
                        const tabId = this.getAttribute("data-tab");
                        profileTabs.forEach((t) =>
                            t.classList.remove("active")
                        );
                        profileContents.forEach((c) =>
                            c.classList.remove("active")
                        );
                        this.classList.add("active");
                        document
                            .getElementById(tabId + "-content")
                            .classList.add("active");
                    });
                });

                // Load profile data
                function loadProfileData() {
                    console.log("Loading profile data for admin");

                    const form = new FormData();
                    form.append("action", "get_profile");
                    form.append("admin_id", adminId || "1");

                    fetch("../../backend/api/admin_profile.php", {
                        method: "POST",
                        body: form,
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            if (data.success && data.data) {
                                const profile = data.data;

                                // Update profile header
                                document.getElementById(
                                    "profile-name"
                                ).textContent =
                                    profile.first_name +
                                    " " +
                                    profile.last_name;
                                document.getElementById(
                                    "profile-email"
                                ).textContent = profile.email;
                                document.getElementById(
                                    "profile-phone"
                                ).textContent = profile.phone || "Not provided";
                                document.getElementById(
                                    "profile-joined"
                                ).textContent = profile.created_at;

                                // Update form fields
                                document.getElementById("first-name").value =
                                    profile.first_name || "";
                                document.getElementById("last-name").value =
                                    profile.last_name || "";
                                document.getElementById("email").value =
                                    profile.email || "";
                                document.getElementById("phone").value =
                                    profile.phone || "";

                                // Set admin role
                                const adminRoleSelect =
                                    document.getElementById("admin-role");
                                if (adminRoleSelect) {
                                    adminRoleSelect.value =
                                        profile.role || "admin";
                                }
                            } else {
                                console.error(
                                    "Failed to load profile:",
                                    data.message
                                );
                                // Set default values if API fails
                                document.getElementById(
                                    "profile-name"
                                ).textContent = "Admin User";
                                document.getElementById(
                                    "profile-email"
                                ).textContent = "admin@bookmarket.com";
                                document.getElementById(
                                    "profile-phone"
                                ).textContent = "+880 123 456789";
                                document.getElementById(
                                    "profile-joined"
                                ).textContent = "January 2023";
                            }
                        })
                        .catch((error) => {
                            console.error("Error loading profile:", error);
                            // Set default values if API fails
                            document.getElementById(
                                "profile-name"
                            ).textContent = "Admin User";
                            document.getElementById(
                                "profile-email"
                            ).textContent = "admin@bookmarket.com";
                            document.getElementById(
                                "profile-phone"
                            ).textContent = "+880 123 456789";
                            document.getElementById(
                                "profile-joined"
                            ).textContent = "January 2023";
                        });
                }

                // Form Submissions
                const personalInfoForm =
                    document.getElementById("personal-info-form");
                const adminSettingsForm = document.getElementById(
                    "admin-settings-form"
                );
                const changePasswordForm = document.getElementById(
                    "change-password-form"
                );
                const preferencesForm =
                    document.getElementById("preferences-form");

                if (personalInfoForm) {
                    personalInfoForm.addEventListener("submit", function (e) {
                        e.preventDefault();

                        const formData = new FormData();
                        formData.append("action", "update_profile");
                        formData.append("admin_id", adminId || "1");
                        formData.append(
                            "first_name",
                            document.getElementById("first-name").value
                        );
                        formData.append(
                            "last_name",
                            document.getElementById("last-name").value
                        );
                        formData.append(
                            "phone",
                            document.getElementById("phone").value
                        );

                        fetch("../../backend/api/admin_profile.php", {
                            method: "POST",
                            body: formData,
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                if (data.success) {
                                    alert("Profile updated successfully!");
                                    loadProfileData(); // Reload profile data
                                } else {
                                    alert(
                                        "Failed to update profile: " +
                                            data.message
                                    );
                                }
                            })
                            .catch((error) => {
                                console.error("Error updating profile:", error);
                                alert(
                                    "Error updating profile. Please try again."
                                );
                            });
                    });
                }

                if (adminSettingsForm) {
                    adminSettingsForm.addEventListener("submit", function (e) {
                        e.preventDefault();

                        const formData = new FormData();
                        formData.append("action", "update_admin_settings");
                        formData.append("admin_id", adminId || "1");
                        formData.append(
                            "role",
                            document.getElementById("admin-role").value
                        );

                        // Get permissions
                        const permissions = [];
                        if (document.getElementById("perm-users").checked)
                            permissions.push("users");
                        if (document.getElementById("perm-books").checked)
                            permissions.push("books");
                        if (document.getElementById("perm-orders").checked)
                            permissions.push("orders");
                        if (document.getElementById("perm-reports").checked)
                            permissions.push("reports");
                        if (document.getElementById("perm-settings").checked)
                            permissions.push("settings");

                        formData.append(
                            "permissions",
                            JSON.stringify(permissions)
                        );

                        fetch("../../backend/api/admin_profile.php", {
                            method: "POST",
                            body: formData,
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                if (data.success) {
                                    alert(
                                        "Admin settings updated successfully!"
                                    );
                                } else {
                                    alert(
                                        "Failed to update admin settings: " +
                                            data.message
                                    );
                                }
                            })
                            .catch((error) => {
                                console.error(
                                    "Error updating admin settings:",
                                    error
                                );
                                alert(
                                    "Error updating admin settings. Please try again."
                                );
                            });
                    });
                }

                if (changePasswordForm) {
                    changePasswordForm.addEventListener("submit", function (e) {
                        e.preventDefault();

                        const currentPassword =
                            document.getElementById("current-password").value;
                        const newPassword =
                            document.getElementById("new-password").value;
                        const confirmPassword =
                            document.getElementById("confirm-password").value;

                        if (newPassword !== confirmPassword) {
                            alert("New passwords do not match!");
                            return;
                        }

                        if (newPassword.length < 6) {
                            alert(
                                "New password must be at least 6 characters long!"
                            );
                            return;
                        }

                        const formData = new FormData();
                        formData.append("action", "change_password");
                        formData.append("admin_id", adminId || "1");
                        formData.append("current_password", currentPassword);
                        formData.append("new_password", newPassword);

                        fetch("../../backend/api/admin_profile.php", {
                            method: "POST",
                            body: formData,
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                if (data.success) {
                                    alert("Password changed successfully!");
                                    // Clear password fields
                                    document.getElementById(
                                        "current-password"
                                    ).value = "";
                                    document.getElementById(
                                        "new-password"
                                    ).value = "";
                                    document.getElementById(
                                        "confirm-password"
                                    ).value = "";
                                } else {
                                    alert(
                                        "Failed to change password: " +
                                            data.message
                                    );
                                }
                            })
                            .catch((error) => {
                                console.error(
                                    "Error changing password:",
                                    error
                                );
                                alert(
                                    "Error changing password. Please try again."
                                );
                            });
                    });
                }

                if (preferencesForm) {
                    preferencesForm.addEventListener("submit", function (e) {
                        e.preventDefault();
                        alert(
                            "Preferences saved successfully! (This feature will be implemented with backend API)"
                        );
                    });
                }

                // Delete Account
                const deleteAccountBtn =
                    document.getElementById("delete-account-btn");
                if (deleteAccountBtn) {
                    deleteAccountBtn.addEventListener("click", function () {
                        const confirmDelete = confirm(
                            "Are you sure you want to delete your admin account? This action cannot be undone."
                        );

                        if (confirmDelete) {
                            const password = prompt(
                                "Please enter your password to confirm account deletion:"
                            );

                            if (password) {
                                const formData = new FormData();
                                formData.append("action", "delete_account");
                                formData.append("admin_id", adminId || "1");
                                formData.append("password", password);

                                fetch("../../backend/api/admin_profile.php", {
                                    method: "POST",
                                    body: formData,
                                })
                                    .then((response) => response.json())
                                    .then((data) => {
                                        if (data.success) {
                                            alert(
                                                "Admin account deleted successfully!"
                                            );
                                            // Clear localStorage and redirect to home
                                            localStorage.clear();
                                            window.location.href =
                                                "../../index.html";
                                        } else {
                                            alert(
                                                "Failed to delete account: " +
                                                    data.message
                                            );
                                        }
                                    })
                                    .catch((error) => {
                                        console.error(
                                            "Error deleting account:",
                                            error
                                        );
                                        alert(
                                            "Error deleting account. Please try again."
                                        );
                                    });
                            }
                        }
                    });
                }
            });
        </script>
    </body>
</html>
