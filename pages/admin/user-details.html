<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>User Details - Admin Dashboard</title>
        <link rel="stylesheet" href="../../css/styles.css" />
        <!-- Additional CSS for User Details page -->
        <style>
            .user-details-container {
                max-width: var(--container-width);
                margin: 2rem auto;
                padding: 0 1rem;
            }

            /* CSS Variables for consistent colors */
            :root {
                --info-color: #17a2b8;
                --success-color: #28a745;
                --warning-color: #ffc107;
                --danger-color: #dc3545;
                --primary-color: #007bff;
                --secondary-color: #6c757d;
                --dark-color: #343a40;
                --border-color: #dee2e6;
            }

            .back-button {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.5rem 1rem;
                background-color: var(--secondary-color);
                color: white;
                text-decoration: none;
                border-radius: 4px;
                margin-bottom: 1rem;
                transition: background-color 0.3s ease;
            }

            .back-button:hover {
                background-color: #5a6c7d;
            }

            .user-header {
                background-color: white;
                border-radius: 8px;
                padding: 2rem;
                margin-bottom: 2rem;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            .user-basic-info {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1.5rem;
                margin-bottom: 2rem;
            }

            .info-group {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }

            .info-label {
                font-weight: 600;
                color: var(--dark-color);
                font-size: 0.9rem;
            }

            .info-value {
                color: #666;
                font-size: 1rem;
            }

            .user-status {
                display: inline-block;
                padding: 0.5rem 1rem;
                border-radius: 50px;
                font-size: 0.9rem;
                font-weight: 600;
            }

            .user-actions {
                display: flex;
                gap: 1rem;
                flex-wrap: wrap;
            }

            .action-button {
                padding: 0.75rem 1.5rem;
                border-radius: 4px;
                font-size: 0.9rem;
                cursor: pointer;
                border: none;
                transition: all 0.3s ease;
                text-decoration: none;
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
            }

            .btn-edit {
                background-color: var(--primary-color);
                color: white;
            }

            .btn-edit:hover {
                background-color: #3a5a80;
            }

            .btn-delete {
                background-color: var(--danger-color);
                color: white;
            }

            .btn-delete:hover {
                background-color: #c0392b;
            }

            .btn-suspend {
                background-color: var(--warning-color);
                color: white;
            }

            .btn-suspend:hover {
                background-color: #e67e22;
            }

            .user-sections {
                display: grid;
                gap: 2rem;
            }

            .section-card {
                background-color: white;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            .section-header {
                padding: 1rem 1.5rem;
                border-bottom: 1px solid var(--border-color);
                background-color: #f8f9fa;
            }

            .section-title {
                margin: 0;
                font-size: 1.2rem;
                color: var(--dark-color);
            }

            .section-content {
                padding: 1.5rem;
            }

            .table-responsive {
                overflow-x: auto;
            }

            .admin-table {
                width: 100%;
                border-collapse: collapse;
            }

            .admin-table th,
            .admin-table td {
                padding: 1rem;
                text-align: left;
                border-bottom: 1px solid var(--border-color);
            }

            .admin-table th {
                font-weight: 600;
                color: var(--dark-color);
                background-color: #f8f9fa;
            }

            .admin-table tr:last-child td {
                border-bottom: none;
            }

            .no-data {
                text-align: center;
                padding: 2rem;
                color: #666;
                font-style: italic;
            }

            .loading {
                text-align: center;
                padding: 2rem;
                color: #666;
            }

            .book-title-cell {
                display: flex;
                flex-direction: column;
            }

            .isbn {
                font-size: 0.8rem;
                color: #888;
            }

            .category-badge {
                background-color: #e0e0e0;
                color: #333;
                padding: 0.3rem 0.7rem;
                border-radius: 5px;
                font-size: 0.8rem;
                font-weight: 600;
            }

            .price-tag {
                background-color: #f0f0f0;
                color: #333;
                padding: 0.3rem 0.7rem;
                border-radius: 5px;
                font-size: 0.9rem;
                font-weight: 600;
            }

            .condition-badge {
                background-color: #f0f0f0;
                color: #333;
                padding: 0.3rem 0.7rem;
                border-radius: 5px;
                font-size: 0.8rem;
                font-weight: 600;
            }

            .condition-new {
                background-color: rgba(39, 174, 96, 0.1);
                color: var(--success-color);
            }

            .condition-used {
                background-color: rgba(231, 76, 60, 0.1);
                color: var(--danger-color);
            }

            .status-badge {
                background-color: #f0f0f0;
                color: #333;
                padding: 0.3rem 0.7rem;
                border-radius: 5px;
                font-size: 0.8rem;
                font-weight: 600;
            }

            .status-approved {
                background-color: rgba(39, 174, 96, 0.1);
                color: var(--success-color);
            }

            .status-pending {
                background-color: rgba(231, 76, 60, 0.1);
                color: var(--danger-color);
            }

            .status-sold {
                background-color: rgba(231, 76, 60, 0.1);
                color: var(--danger-color);
            }

            /* Order Status Badges */
            .status-pending {
                background-color: rgba(255, 193, 7, 0.1);
                color: #ffc107;
            }

            .status-processing {
                background-color: rgba(52, 152, 219, 0.1);
                color: #3498db;
            }

            .status-shipped {
                background-color: rgba(155, 89, 182, 0.1);
                color: #9b59b6;
            }

            .status-delivered {
                background-color: rgba(39, 174, 96, 0.1);
                color: var(--success-color);
            }

            .status-cancelled {
                background-color: rgba(231, 76, 60, 0.1);
                color: var(--danger-color);
            }

            /* Payment Status Badges */
            .payment-pending {
                background-color: rgba(255, 193, 7, 0.1);
                color: #ffc107;
            }

            .payment-paid {
                background-color: rgba(39, 174, 96, 0.1);
                color: var(--success-color);
            }

            .payment-failed {
                background-color: rgba(231, 76, 60, 0.1);
                color: var(--danger-color);
            }

            .book-actions {
                display: flex;
                gap: 0.5rem;
            }

            .action-btn {
                padding: 0.4rem 0.8rem;
                border-radius: 4px;
                font-size: 0.8rem;
                cursor: pointer;
                border: none;
                transition: all 0.3s ease;
                display: inline-flex;
                align-items: center;
                gap: 0.3rem;
            }

            .btn-view-book {
                background-color: var(--info-color);
                color: white;
            }

            .btn-view-book:hover {
                background-color: #5a6c7d;
            }

            .btn-edit-book {
                background-color: var(--primary-color);
                color: white;
            }

            .btn-edit-book:hover {
                background-color: #3a5a80;
            }

            .books-summary {
                margin-top: 2rem;
                padding: 1.5rem;
                background-color: #f8f9fa;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            }

            .summary-card {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 1rem;
                text-align: center;
            }

            .summary-item {
                display: flex;
                flex-direction: column;
                gap: 0.3rem;
            }

            .summary-label {
                font-size: 0.8rem;
                color: #888;
            }

            .summary-value {
                font-size: 1.2rem;
                font-weight: 600;
                color: var(--dark-color);
            }

            .summary-value.approved {
                color: var(--success-color);
            }

            .summary-value.pending {
                color: var(--danger-color);
            }

            .summary-value.sold {
                color: var(--danger-color);
            }

            .summary-value.price {
                color: var(--primary-color);
            }

            .summary-value.completed {
                color: var(--success-color);
            }

            .summary-value.cancelled {
                color: var(--danger-color);
            }

            .order-number-cell {
                font-size: 0.9rem;
                color: #333;
            }

            .order-id {
                font-size: 0.7rem;
                color: #888;
            }

            .order-date-cell {
                font-size: 0.9rem;
                color: #333;
            }

            .order-time {
                font-size: 0.7rem;
                color: #888;
            }

            .order-items-cell {
                font-size: 0.9rem;
                color: #333;
            }

            .items-count {
                font-weight: 600;
            }

            .items-quantity {
                font-size: 0.7rem;
                color: #888;
            }

            .order-amount {
                font-size: 1.1rem;
                font-weight: 600;
                color: var(--primary-color);
            }

            .order-actions {
                display: flex;
                gap: 0.5rem;
            }

            .action-btn.btn-view-order {
                background-color: var(--info-color);
                color: white;
            }

            .action-btn.btn-view-order:hover {
                background-color: #5a6c7d;
            }

            .action-btn.btn-edit-order {
                background-color: var(--primary-color);
                color: white;
            }

            .action-btn.btn-edit-order:hover {
                background-color: #3a5a80;
            }

            .orders-summary {
                margin-top: 2rem;
                padding: 1.5rem;
                background-color: #f8f9fa;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            }

            .summary-item.completed {
                color: var(--success-color);
            }

            .summary-item.cancelled {
                color: var(--danger-color);
            }

            .payment-badge {
                background-color: #f0f0f0;
                color: #333;
                padding: 0.3rem 0.7rem;
                border-radius: 5px;
                font-size: 0.8rem;
                font-weight: 600;
            }

            .payment-badge.paid {
                background-color: rgba(39, 174, 96, 0.1);
                color: var(--success-color);
            }

            .payment-badge.pending {
                background-color: rgba(231, 76, 60, 0.1);
                color: var(--danger-color);
            }

            .payment-badge.refunded {
                background-color: rgba(155, 89, 182, 0.1);
                color: #9b59b6;
            }

            .payment-badge.failed {
                background-color: rgba(231, 76, 60, 0.1);
                color: var(--danger-color);
            }

            @media screen and (max-width: 768px) {
                .user-basic-info {
                    grid-template-columns: 1fr;
                }

                .user-actions {
                    flex-direction: column;
                }

                .action-button {
                    justify-content: center;
                }
            }
        </style>
        <!-- Font Awesome for icons -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
    </head>
    <body>
        <!-- Navbar (Common Admin Navbar) -->
        <nav class="navbar">
            <!-- Navbar will be generated by admin-navbar.js -->
        </nav>

        <!-- User Details Content -->
        <div class="user-details-container">
            <a href="dashboard.html" class="back-button">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>

            <div class="user-header">
                <h1>User Details</h1>
                <div id="user-basic-info" class="user-basic-info">
                    <div class="loading">Loading user information...</div>
                </div>
                <div
                    id="user-actions"
                    class="user-actions"
                    style="display: none"
                >
                    <!-- Action buttons will be populated here -->
                </div>
            </div>

            <div class="user-sections">
                <!-- User's Books Section -->
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="section-title">User's Books</h3>
                    </div>
                    <div class="section-content">
                        <div id="user-books-content">
                            <div class="loading">Loading books...</div>
                        </div>
                    </div>
                </div>

                <!-- User's Orders Section -->
                <div class="section-card">
                    <div class="section-header">
                        <h3 class="section-title">User's Orders</h3>
                    </div>
                    <div class="section-content">
                        <div id="user-orders-content">
                            <div class="loading">Loading orders...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification Container -->
        <div id="notification-container" class="notification-container"></div>

        <!-- JavaScript -->
        <script src="../../js/main.js"></script>
        <script src="../../js/auth.js"></script>
        <script src="../../js/admin-navbar.js"></script>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // Get user ID from URL parameter first
                const urlParams = new URLSearchParams(window.location.search);
                const userId = urlParams.get("id");

                if (!userId) {
                    showNotification("No user ID provided", "error");
                    return;
                }

                // Check if user is authenticated as admin
                function checkAdminAuth() {
                    const form = new FormData();
                    form.append("action", "check_admin_auth");

                    fetch("../../backend/auth/user_auth.php", {
                        method: "POST",
                        body: form,
                    })
                        .then((r) => r.json())
                        .then((d) => {
                            if (!d.success) {
                                showNotification(
                                    "Access denied. Please login as admin.",
                                    "error"
                                );
                                setTimeout(() => {
                                    window.location.href =
                                        "../../pages/login.html";
                                }, 2000);
                                return;
                            }
                            // User is authenticated, continue loading user details
                            loadUserDetails(userId);
                            loadUserBooks(userId);
                            loadUserOrders(userId);
                        })
                        .catch((error) => {
                            console.error("Auth check error:", error);
                            showNotification(
                                "Authentication failed. Please login again.",
                                "error"
                            );
                            setTimeout(() => {
                                window.location.href = "../../pages/login.html";
                            }, 2000);
                        });
                }

                // Now check authentication after userId is defined
                checkAdminAuth();

                // Load user details after authentication
                // loadUserDetails(userId);
                // loadUserBooks(userId);
                // loadUserOrders(userId);

                // Event delegation for action buttons
                document.addEventListener("click", function (e) {
                    if (e.target.classList.contains("btn-delete")) {
                        if (
                            confirm(
                                "Are you sure you want to delete this user? This action cannot be undone."
                            )
                        ) {
                            deleteUser(userId);
                        }
                    } else if (e.target.classList.contains("btn-view-book")) {
                        const bookId = e.target.dataset.bookId;
                        showNotification(`Viewing book ID: ${bookId}`, "info");
                        // TODO: Implement book details view
                    } else if (e.target.classList.contains("btn-edit-book")) {
                        const bookId = e.target.dataset.bookId;
                        showNotification(`Editing book ID: ${bookId}`, "info");
                        // TODO: Implement book edit functionality
                    } else if (e.target.classList.contains("btn-view-order")) {
                        const orderId = e.target.dataset.orderId;
                        showNotification(
                            `Viewing order ID: ${orderId}`,
                            "info"
                        );
                        // TODO: Implement order details view
                    } else if (e.target.classList.contains("btn-edit-order")) {
                        const orderId = e.target.dataset.orderId;
                        showNotification(
                            `Editing order ID: ${orderId}`,
                            "info"
                        );
                        // TODO: Implement order edit functionality
                    }
                });
            });

            function loadUserDetails(userId) {
                const form = new FormData();
                form.append("action", "get_user_details");
                form.append("user_id", userId);

                fetch("../../backend/auth/user_auth.php", {
                    method: "POST",
                    body: form,
                })
                    .then((r) => r.json())
                    .then((d) => {
                        if (d.success && d.data) {
                            displayUserInfo(d.data);
                        } else {
                            showNotification(
                                "Failed to load user details",
                                "error"
                            );
                        }
                    })
                    .catch((error) => {
                        console.error("Load user details error:", error);
                        showNotification(
                            "Failed to load user details",
                            "error"
                        );
                    });
            }

            function displayUserInfo(user) {
                const basicInfo = document.getElementById("user-basic-info");
                const actions = document.getElementById("user-actions");

                basicInfo.innerHTML = `
                    <div class="info-group">
                        <div class="info-label">Username</div>
                        <div class="info-value">${user.username || "N/A"}</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">Full Name</div>
                        <div class="info-value">${user.first_name || ""} ${
                    user.last_name || ""
                }</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">Email</div>
                        <div class="info-value">${user.email || "N/A"}</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">Phone</div>
                        <div class="info-value">${user.phone || "N/A"}</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">User Type</div>
                        <div class="info-value">${
                            user.user_type === "admin" ? "Admin" : "Customer"
                        }</div>
                    </div>

                    <div class="info-group">
                        <div class="info-label">Address</div>
                        <div class="info-value">${user.address || "N/A"}</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">City</div>
                        <div class="info-value">${user.city || "N/A"}</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">Country</div>
                        <div class="info-value">${user.country || "N/A"}</div>
                    </div>
                    <div class="info-group">
                        <div class="info-label">Joined Date</div>
                        <div class="info-value">${new Date(
                            user.created_at
                        ).toLocaleDateString()}</div>
                    </div>
                `;

                // Only show actions for non-admin users
                if (user.user_type !== "admin") {
                    actions.style.display = "flex";
                    actions.innerHTML = `
                        <button class="action-button btn-edit" onclick="editUser(${user.id})">
                            <i class="fas fa-edit"></i> Edit User
                        </button>

                        <button class="action-button btn-delete">
                            <i class="fas fa-trash"></i> Delete User
                        </button>
                    `;
                }
            }

            function loadUserBooks(userId) {
                const form = new FormData();
                form.append("action", "get_user_books");
                form.append("user_id", userId);

                fetch("../../backend/books/book_manager.php", {
                    method: "POST",
                    body: form,
                })
                    .then((r) => r.json())
                    .then((d) => {
                        const content =
                            document.getElementById("user-books-content");
                        if (
                            d.success &&
                            Array.isArray(d.data) &&
                            d.data.length > 0
                        ) {
                            displayUserBooks(d.data);
                        } else {
                            content.innerHTML =
                                '<div class="no-data">No books found for this user</div>';
                        }
                    })
                    .catch((error) => {
                        console.error("Load user books error:", error);
                        document.getElementById(
                            "user-books-content"
                        ).innerHTML =
                            '<div class="no-data">Failed to load books</div>';
                    });
            }

            function displayUserBooks(books) {
                const content = document.getElementById("user-books-content");
                let html =
                    '<div class="table-responsive"><table class="admin-table">';
                html +=
                    "<thead><tr><th>Book Title</th><th>Author</th><th>Category</th><th>Price</th><th>Condition</th><th>Status</th><th>Created</th></tr></thead><tbody>";

                books.forEach((book) => {
                    const statusClass = `status-${book.status}`;
                    const statusText =
                        book.status.charAt(0).toUpperCase() +
                        book.status.slice(1);

                    html += `
                        <tr>
                            <td>
                                <div class="book-title-cell">
                                    <strong>${book.title}</strong>
                                    ${
                                        book.isbn
                                            ? `<br><small class="isbn">ISBN: ${book.isbn}</small>`
                                            : ""
                                    }
                                </div>
                            </td>
                            <td>${book.author}</td>
                            <td>
                                <span class="category-badge">${
                                    book.category_name || "N/A"
                                }</span>
                            </td>
                            <td>
                                <span class="price-tag">৳${parseFloat(
                                    book.price
                                ).toLocaleString()}</span>
                            </td>
                            <td>
                                <span class="condition-badge condition-${book.book_condition.toLowerCase()}">${
                        book.book_condition
                    }</span>
                            </td>
                            <td>
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </td>
                            <td>${new Date(
                                book.created_at
                            ).toLocaleDateString()}</td>
                        </tr>
                    `;
                });

                html += "</tbody></table></div>";

                // Add summary statistics
                const totalBooks = books.length;
                const approvedBooks = books.filter(
                    (b) => b.status === "approved"
                ).length;
                const pendingBooks = books.filter(
                    (b) => b.status === "pending"
                ).length;
                const soldBooks = books.filter(
                    (b) => b.status === "sold"
                ).length;
                const totalValue = books.reduce(
                    (sum, book) => sum + parseFloat(book.price),
                    0
                );

                html += `
                    <div class="books-summary">
                        <div class="summary-card">
                            <div class="summary-item">
                                <span class="summary-label">Total Books:</span>
                                <span class="summary-value">${totalBooks}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Approved:</span>
                                <span class="summary-value approved">${approvedBooks}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Pending:</span>
                                <span class="summary-value pending">${pendingBooks}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Sold:</span>
                                <span class="summary-value sold">${soldBooks}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">Total Value:</span>
                                <span class="summary-value price">৳${totalValue.toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                `;

                content.innerHTML = html;
            }

            function loadUserOrders(userId) {
                console.log("Loading orders for user:", userId);
                const form = new FormData();
                form.append("action", "get_user_orders");
                form.append("user_id", userId);

                fetch("../../backend/orders/order_manager.php", {
                    method: "POST",
                    body: form,
                })
                    .then((r) => r.json())
                    .then((d) => {
                        console.log("Orders response:", d);
                        const content = document.getElementById(
                            "user-orders-content"
                        );
                        if (
                            d.success &&
                            Array.isArray(d.data) &&
                            d.data.length > 0
                        ) {
                            console.log("Displaying orders:", d.data);
                            displayUserOrders(d.data);
                        } else {
                            console.log("No orders found or error:", d);
                            content.innerHTML =
                                '<div class="no-data">No orders found for this user</div>';
                        }
                    })
                    .catch((error) => {
                        console.error("Load user orders error:", error);
                        document.getElementById(
                            "user-orders-content"
                        ).innerHTML =
                            '<div class="no-data">Failed to load orders</div>';
                    });
            }

            function displayUserOrders(orders) {
                const content = document.getElementById("user-orders-content");
                let html =
                    '<div class="table-responsive"><table class="admin-table">';
                html +=
                    "<thead><tr><th>Order #</th><th>Date</th><th>Items</th><th>Amount</th><th>Status</th><th>Payment</th><th>Actions</th></tr></thead><tbody>";

                orders.forEach((order) => {
                    const statusClass = `status-${order.order_status.toLowerCase()}`;
                    const statusText = order.order_status;
                    const paymentClass = `payment-${order.payment_status.toLowerCase()}`;

                    html += `
                        <tr>
                            <td>
                                <div class="order-number-cell">
                                    <strong>#${order.order_number}</strong>
                                    <br><small class="order-id">ID: ${
                                        order.id
                                    }</small>
                                </div>
                            </td>
                            <td>
                                <div class="order-date-cell">
                                    <div>${new Date(
                                        order.order_date
                                    ).toLocaleDateString()}</div>
                                    <small class="order-time">${new Date(
                                        order.order_date
                                    ).toLocaleTimeString()}</small>
                                </div>
                            </td>
                            <td>
                                <div class="order-items-cell">
                                    <span class="items-count">${
                                        order.total_items || 0
                                    } items</span>
                                    <br><small class="items-quantity">Qty: ${
                                        order.total_quantity || 0
                                    }</small>
                                </div>
                            </td>
                            <td>
                                <span class="order-amount">৳${parseFloat(
                                    order.total_amount
                                ).toLocaleString()}</span>
                            </td>
                            <td>
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </td>
                            <td>
                                <span class="payment-badge ${paymentClass}">${
                        order.payment_status
                    }</span>
                            </td>
                            <td>
                                <div class="order-actions">
                                    <button class="action-btn btn-view-order" data-order-id="${
                                        order.id
                                    }" title="View Order Details">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn btn-edit-order" data-order-id="${
                                        order.id
                                    }" title="Edit Order">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });

                html += "</tbody></table></div>";

                // Add summary statistics
                if (orders.length > 0) {
                    const totalOrders = orders.length;
                    const totalSpent = orders.reduce(
                        (sum, order) => sum + parseFloat(order.total_amount),
                        0
                    );
                    const pendingOrders = orders.filter(
                        (o) => o.order_status === "Pending"
                    ).length;
                    const completedOrders = orders.filter((o) =>
                        ["Delivered", "Shipped"].includes(o.order_status)
                    ).length;
                    const cancelledOrders = orders.filter(
                        (o) => o.order_status === "Cancelled"
                    ).length;

                    html += `
                        <div class="orders-summary">
                            <div class="summary-card">
                                <div class="summary-item">
                                    <span class="summary-label">Total Orders:</span>
                                    <span class="summary-value">${totalOrders}</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">Total Spent:</span>
                                    <span class="summary-value price">৳${totalSpent.toLocaleString()}</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">Pending:</span>
                                    <span class="summary-value pending">${pendingOrders}</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">Completed:</span>
                                    <span class="summary-value completed">${completedOrders}</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">Cancelled:</span>
                                    <span class="summary-value cancelled">${cancelledOrders}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }

                content.innerHTML = html;
            }

            function deleteUser(userId) {
                const form = new FormData();
                form.append("action", "delete_user");
                form.append("user_id", userId);

                fetch("../../backend/auth/user_auth.php", {
                    method: "POST",
                    body: form,
                })
                    .then((r) => r.json())
                    .then((d) => {
                        if (d.success) {
                            showNotification(
                                "User deleted successfully",
                                "success"
                            );
                            setTimeout(() => {
                                window.location.href = "dashboard.html";
                            }, 1500);
                        } else {
                            showNotification(
                                "Failed to delete user: " +
                                    (d.message || "Unknown error"),
                                "error"
                            );
                        }
                    })
                    .catch((error) => {
                        console.error("Delete user error:", error);
                        showNotification(
                            "Failed to delete user. Please try again.",
                            "error"
                        );
                    });
            }

            function editUser(userId) {
                // Redirect to user management page or show edit modal
                showNotification("Edit functionality coming soon", "info");
            }
        </script>
    </body>
</html>
